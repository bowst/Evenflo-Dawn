{{ 'section-evenflo-answer.css' | asset_url | stylesheet_tag }}

<div class="question-block">
  <div class="page-width">
    <div class="question-banner-wrapper">
      <!-- Content will be inserted here dynamically -->
    </div>
  </div>
</div>

<script>
function productList() {
  const productList = document.querySelector(".question-banner-wrapper .product-list");
  const toggleLink = document.querySelector(".question-banner-links");
  
  if (!productList || !toggleLink) return;

  const products = productList.querySelectorAll(".product-content");
  if (products.length <= 3) {
    toggleLink.style.display = "none";  // Hide toggle button if no more than 3 products
    return;
  }

  console.log('products.length',products.length)

  // // Initially hide products after the first three
  // for (let i = 3; i < products.length; i++) {
  //   products[i].style.display = "none";
  // }

  // Display the toggle button
  toggleLink.style.display = "block";
  toggleLink.innerHTML = `<span>Show more products</span>`;

  alert(2222)

  // Add click event listener to toggle visibility
  toggleLink.addEventListener("click", () => {
    const isHidden = products[3].style.display === "none";
    for (let i = 3; i < products.length; i++) {
      products[i].style.display = isHidden ? "block" : "none";
    }
    toggleLink.innerHTML = `<span>${isHidden ? 'Show less products' : 'Show more products'}</span>`;
  });
}




  // Function to fetch and display FAQ data
  function fetchQuestionsAnswerData(id) {
  const container = document.querySelector('.question-banner-wrapper');
  const questionAnswerBlock = document.getElementById('questionAnswerBlock');
  let blocksToShow = questionAnswerBlock ? questionAnswerBlock.dataset.faqsToShow : 1;

  if (!container) {
    return;
  }

  container.innerHTML = "";  // Clear existing content

  const loader = appendLoader(container);

  fetch(evenFloFAQURL + 'faqs/' + id)
    .then(response => response.json())
    .then(product => {

      if(product?.detail && containsString(product?.detail,errorString())){
        redirectIfNoData([])
        return ""
      }
      
      let productsContent = "";
      product?.products?.forEach(nestedProduct => {
        productsContent += `
        <a href="/pages/evenflo-faq-product?pid=${nestedProduct?.id}">
          <div class="product-content">
            <div class="product-img">
              <img src="${nestedProduct?.image}" alt="product" />
            </div>
            <div class="product-title">
              ${nestedProduct?.name}
            </div>
          </div></a>`;
      });

      const tags = getTagsArray(product?.tags || []);
      const tagsHtml = getTagsHtml(tags);

      // Update breadcrumb links
      getBreadCrumbLinks(product?.question, 'question-answer');

      container.innerHTML = `
        <div class="question-col question-col-1">
          <div class="question-content">
            <div class="heading">
              <h1>
                <span>${product?.question}</span>
                <span onclick="copyCurrentUrlToClipboard()" class="copy-clipboard-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="25" viewBox="0 0 30 25" fill="none" class="copy-clipboard-svg">
                      <path d="M27.1875 13.0625L21.8906 18.3594C19.2188 20.9844 14.9531 20.9844 12.3281 18.3594C9.84375 15.8281 9.70312 11.8438 12 9.17188L12.2344 8.89062C12.6562 8.42188 13.3594 8.375 13.8281 8.79688C14.2969 9.21875 14.3438 9.92188 13.9219 10.3906L13.7344 10.625C12.1406 12.4062 12.2344 15.0781 13.9219 16.7656C15.6562 18.5 18.5156 18.5 20.2969 16.7656L25.5938 11.4688C27.3281 9.6875 27.3281 6.875 25.5938 5.09375C23.9062 3.45312 21.2344 3.35938 19.4531 4.90625L19.1719 5.14062C18.7031 5.5625 18 5.51562 17.5781 5.04688C17.1562 4.57812 17.2031 3.875 17.6719 3.45312L17.9531 3.21875C20.625 0.875 24.6562 1.01562 27.1875 3.5C29.8125 6.125 29.8125 10.3906 27.1875 13.0625ZM2.76562 11.9844L8.10938 6.6875C10.7344 4.0625 15 4.0625 17.625 6.6875C20.1562 9.17188 20.2969 13.2031 17.9531 15.875L17.6719 16.1562C17.2969 16.625 16.5469 16.7188 16.0781 16.2969C15.6094 15.875 15.5625 15.1719 15.9844 14.7031L16.2656 14.4219C17.8125 12.6406 17.7188 9.96875 16.0312 8.28125C14.2969 6.5 11.4375 6.5 9.70312 8.28125L4.35938 13.5781C2.625 15.3125 2.625 18.1719 4.35938 19.9531C6.04688 21.5938 8.71875 21.6875 10.5 20.1406L10.7812 19.9062C11.25 19.4844 11.9531 19.5312 12.375 20C12.7969 20.4688 12.75 21.1719 12.2812 21.5938L12 21.8281C9.32812 24.1719 5.29688 24.0312 2.76562 21.5469C0.140625 18.9219 0.140625 14.6094 2.76562 11.9844Z" fill="#00AEA9"></path>
                    </svg>
                    <svg class="copied-clipboard-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px">
                      <path fill="#00aea94d" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/>
                      <path fill="#00AEA9" d="M34.586,14.586l-13.57,13.586l-5.602-5.586l-2.828,2.828l8.434,8.414l16.395-16.414L34.586,14.586z"/>
                    </svg>
                  </span>
              </h1>
              <div onclick="copyCurrentUrlToClipboard()" class="copy-clipboard-btn">
               <span>COPY LINK</span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="25" viewBox="0 0 30 25" fill="none" class="copy-clipboard-svg">
                    <path d="M27.1875 13.0625L21.8906 18.3594C19.2188 20.9844 14.9531 20.9844 12.3281 18.3594C9.84375 15.8281 9.70312 11.8438 12 9.17188L12.2344 8.89062C12.6562 8.42188 13.3594 8.375 13.8281 8.79688C14.2969 9.21875 14.3438 9.92188 13.9219 10.3906L13.7344 10.625C12.1406 12.4062 12.2344 15.0781 13.9219 16.7656C15.6562 18.5 18.5156 18.5 20.2969 16.7656L25.5938 11.4688C27.3281 9.6875 27.3281 6.875 25.5938 5.09375C23.9062 3.45312 21.2344 3.35938 19.4531 4.90625L19.1719 5.14062C18.7031 5.5625 18 5.51562 17.5781 5.04688C17.1562 4.57812 17.2031 3.875 17.6719 3.45312L17.9531 3.21875C20.625 0.875 24.6562 1.01562 27.1875 3.5C29.8125 6.125 29.8125 10.3906 27.1875 13.0625ZM2.76562 11.9844L8.10938 6.6875C10.7344 4.0625 15 4.0625 17.625 6.6875C20.1562 9.17188 20.2969 13.2031 17.9531 15.875L17.6719 16.1562C17.2969 16.625 16.5469 16.7188 16.0781 16.2969C15.6094 15.875 15.5625 15.1719 15.9844 14.7031L16.2656 14.4219C17.8125 12.6406 17.7188 9.96875 16.0312 8.28125C14.2969 6.5 11.4375 6.5 9.70312 8.28125L4.35938 13.5781C2.625 15.3125 2.625 18.1719 4.35938 19.9531C6.04688 21.5938 8.71875 21.6875 10.5 20.1406L10.7812 19.9062C11.25 19.4844 11.9531 19.5312 12.375 20C12.7969 20.4688 12.75 21.1719 12.2812 21.5938L12 21.8281C9.32812 24.1719 5.29688 24.0312 2.76562 21.5469C0.140625 18.9219 0.140625 14.6094 2.76562 11.9844Z" fill="#00AEA9"></path>
                  </svg>
                  <svg class="copied-clipboard-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px">
                    <path fill="#00aea94d" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/>
                    <path fill="#00AEA9" d="M34.586,14.586l-13.57,13.586l-5.602-5.586l-2.828,2.828l8.434,8.414l16.395-16.414L34.586,14.586z"/>
                  </svg>
              </div>
              <p>Updated ${formatPostedDate(product?.updated)}</p>
            </div>
            <div class="description">
              <p>${product?.answer}</p>
            </div>
            <div class="question-banner-links">
              ${tagsHtml}
            </div>
          </div>
        </div>
        
        <div class="question-col">
          <div class="question-content">
            <div class="heading">
              <h2>Related Products</h2>
            </div>
            <div class="product-list">
              ${productsContent}
            </div>
            <div class="question-banner-links">
              <span>Show more products</span>
              <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M11.75 5.25C11.875 5.25 12 5.375 12 5.5V6.5C12 6.65625 11.875 6.75 11.75 6.75H6.75V11.75C6.75 11.9062 6.625 12 6.5 12H5.5C5.34375 12 5.25 11.9062 5.25 11.75V6.75H0.25C0.09375 6.75 0 6.65625 0 6.5V5.5C0 5.375 0.09375 5.25 0.25 5.25H5.25V0.25C5.25 0.125 5.34375 0 5.5 0H6.5C6.625 0 6.75 0.125 6.75 0.25V5.25H11.75Z" fill="#2996C5"></path>
                </svg>
              </span>
            </div>
          </div>
        </div>`;
    })
    .catch(error => {
      console.error('Error fetching products:', error);
      redirectIfNoData([])
    })
    .finally(() => {
      // Hide the loader
      if (loader) {
        loader.style.display = 'none';
        productList();  // Call the function to set up the product list
      }
    });
}


  // Initialize the script when the document is fully loaded
  document.addEventListener('DOMContentLoaded', () => {
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    if (urlParams.has('qid')) {
      let questionID = urlParams.get('qid');
      fetchQuestionsAnswerData(questionID);
    } else {
      window.location.href = '/pages/evenflo-faq-portal';
    }
  });
</script>
