{{ 'section-evenflo-answer.css' | asset_url | stylesheet_tag }}

<div class="question-block">
  <div class="page-width">
    <div class="question-banner-wrapper">
      <!-- Content will be inserted here dynamically -->
    </div>
  </div>
</div>

<script>
  // Function to initialize product list interactions
  function productList() {
  const productList = document.querySelector(".question-banner-wrapper .product-list");
  if (!productList) return;

  const products = productList.querySelectorAll(".product-content");
  if (products.length <= 3) return;  // No need to hide if there are 3 or fewer products

  // Hide products after the first three
  for (let i = 3; i < products.length; i++) {
    products[i].style.display = "none";
  }

  // Show the toggle button
  const toggleLink = document.querySelector(".question-banner-links");
  if (toggleLink) {
    toggleLink.style.display = "block";  // Make sure the toggle link is visible
    toggleLink.addEventListener("click", () => {
      const isHidden = products[3].style.display === "none";
      for (let i = 3; i < products.length; i++) {
        products[i].style.display = isHidden ? "block" : "none";
      }
      toggleLink.querySelector("span").textContent = isHidden ? "Show less products" : "Show more products";
    });
  }
}



  // Function to fetch and display FAQ data
  function fetchQuestionsAnswerData(id) {
  const container = document.querySelector('.question-banner-wrapper');
  const questionAnswerBlock = document.getElementById('questionAnswerBlock');
  let blocksToShow = questionAnswerBlock ? questionAnswerBlock.dataset.faqsToShow : 1;

  if (!container) {
    return;
  }

  container.innerHTML = "";  // Clear existing content

  const loader = appendLoader(container);

  fetch(evenFloFAQURL + 'faqs/' + id)
    .then(response => response.json())
    .then(product => {

      if(product?.detail && containsString(product?.detail,errorString())){
        redirectIfNoData([])
        return ""
      }
      
      let productsContent = "";
      product?.products?.forEach(nestedProduct => {
        productsContent += `
        <a href="/pages/evenflo-faq-product?pid=${nestedProduct?.id}">
          <div class="product-content">
            <div class="product-img">
              <img src="${nestedProduct?.image}" alt="product" />
            </div>
            <div class="product-title">
              ${nestedProduct?.name}
            </div>
          </div></a>`;
      });

      const tags = getTagsArray(product?.tags || []);
      const tagsHtml = getTagsHtml(tags);

      // Update breadcrumb links
      getBreadCrumbLinks(product?.question, 'question-answer');

      container.innerHTML = `
        <div class="question-col question-col-1">
          <div class="question-content">
            <div class="heading">
              <h1>
                <span>${product?.question}</span>
                <span onclick="copyCurrentUrlToClipboard()" class="copy-clipboard-btn">
                  <!-- SVGs omitted for brevity -->
                </span>
              </h1>
              <div onclick="copyCurrentUrlToClipboard()" class="copy-clipboard-btn">
                <span>COPY LINK</span>
                <!-- SVGs omitted for brevity -->
              </div>
              <p>Updated ${formatPostedDate(product?.updated)}</p>
            </div>
            <div class="description">
              <p>${product?.answer}</p>
            </div>
            <div class="question-banner-links">
              ${tagsHtml}
            </div>
          </div>
        </div>
        
        <div class="question-col">
          <div class="question-content">
            <div class="heading">
              <h2>Related Products</h2>
            </div>
            <div class="product-list">
              ${productsContent}
            </div>
            <div class="question-banner-links" style="display: none;">
              <span>Show more products</span>
              <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M11.75 5.25C11.875 5.25 12 5.375 12 5.5V6.5C12 6.65625 11.875 6.75 11.75 6.75H6.75V11.75C6.75 11.9062 6.625 12 6.5 12H5.5C5.34375 12 5.25 11.9062 5.25 11.75V6.75H0.25C0.09375 6.75 0 6.65625 0 6.5V5.5C0 5.375 0.09375 5.25 0.25 5.25H5.25V0.25C5.25 0.125 5.34375 0 5.5 0H6.5C6.625 0 6.75 0.125 6.75 0.25V5.25H11.75Z" fill="#2996C5"></path>
                </svg>
              </span>
            </div>
          </div>
        </div>`;
    })
    .catch(error => {
      console.error('Error fetching products:', error);
      redirectIfNoData([])
    })
    .finally(() => {
      // Hide the loader
      if (loader) {
        loader.style.display = 'none';
        productList();  // Call the function to set up the product list
      }
    });
}


  // Initialize the script when the document is fully loaded
  document.addEventListener('DOMContentLoaded', () => {
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    if (urlParams.has('qid')) {
      let questionID = urlParams.get('qid');
      fetchQuestionsAnswerData(questionID);
    } else {
      window.location.href = '/pages/evenflo-faq-portal';
    }
  });
</script>
