{{ 'component-article-card.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'section-main-blog.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{% assign tag = page.title %}
{% assign filtered_articles = '' %}

{%- for article in blogs['evenflo-blog'].articles -%}
  {% if article.tags contains tag %}
    {% assign filtered_articles = filtered_articles | append: article.id | append: ',' %}
  {% endif %}
{%- endfor -%}

{% assign filtered_articles = filtered_articles | split: ',' %}
{% assign items_per_page = 6 %}
{% assign current_page = 1 %}
{% if paginate.current_page %}
  {% assign current_page = paginate.current_page %}
{% endif %}
{% assign start_index = items_per_page | times: current_page | minus: items_per_page %}
{% assign end_index = start_index | plus: items_per_page %}

<div class="main-blog page-width section-{{ section.id }}-padding">
  <h1 class="title--primary">{{ page.title | escape }}</h1>

  <div class="blog-articles {% if section.settings.layout == 'collage' %}blog-articles--collage{% endif %}">
    {% for article_id in filtered_articles %}
      {% if forloop.index0 >= start_index and forloop.index0 < end_index %}
        {% assign article = blogs['evenflo-blog'].articles | where: 'id', article_id | first %}
        <div class="blog-articles__article article">
          {%- render 'article-card',
            article: article,
            media_height: section.settings.image_height,
            media_aspect_ratio: article.image.aspect_ratio,
            show_image: section.settings.show_image,
            show_date: section.settings.show_date,
            show_author: section.settings.show_author,
            show_excerpt: true
          -%}
        </div>
      {% endif %}
    {% endfor %}
  </div>

  <div class="pagination">
    {% if filtered_articles.size > items_per_page %}
      <ul class="pagination__list">
        {% assign total_pages = filtered_articles.size | divided_by: items_per_page | ceil %}
        {% if current_page > 1 %}
          <li><a href="{{ paginate.previous.url }}" class="pagination__link">&larr; Previous</a></li>
        {% endif %}
        {% for i in (1..total_pages) %}
          <li>
            <a
              href="?page={{ i }}"
              class="pagination__link {% if i == current_page %}pagination__link--current{% endif %}"
            >
              {{- i -}}
            </a>
          </li>
        {% endfor %}
        {% if current_page < total_pages %}
          <li><a href="{{ paginate.next.url }}" class="pagination__link">Next &rarr;</a></li>
        {% endif %}
      </ul>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Blog Tag Page",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "select",
      "id": "layout",
      "options": [
        {
          "value": "grid",
          "label": "Grid"
        },
        {
          "value": "collage",
          "label": "Collage"
        }
      ],
      "default": "collage",
      "label": "Layout"
    },
    {
      "type": "checkbox",
      "id": "show_image",
      "default": true,
      "label": "Show Image"
    },
    {
      "type": "select",
      "id": "image_height",
      "options": [
        {
          "value": "adapt",
          "label": "Adapt"
        },
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "medium",
      "label": "Image Height"
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "default": true,
      "label": "Show Date"
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "default": false,
      "label": "Show Author"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 36
    }
  ],
   "presets": [
    {
      "name": "Blog Tag Page"
    }
  ]
}
{% endschema %}
